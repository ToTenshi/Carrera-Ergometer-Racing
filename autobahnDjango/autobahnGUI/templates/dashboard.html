{% load static %}
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Makertreff Racer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5 text-center">
        <object data="{% static 'Logo.svg' %}" type="image/svg+xml" style="max-width: 300px;">
            Ihr Browser kann leider kein svg darstellen!
        </object>



        <form method="post" action="{% url 'controlbuttons' %}">
            {% csrf_token %}
            
            <div class="my-3">
                <label for="rounds" class="form-label">Rundenanzahl:</label>
                <input type="number" id="rounds" name="rounds" class="form-control w-25 mx-auto" min="1" value="{{ rounds|default:1 }}">
            </div>
            <div class="my-3">
                <button type="submit" name="action" value="start" class="btn btn-success">Start</button>
                <button type="submit" name="action" value="pause" class="btn btn-warning">Pause</button>
                <button type="submit" name="action" value="stop" class="btn btn-danger">Stop</button>
            </div>
        </form>

        <div class="row mt-4">
            <!-- Auto 1 -->
            <div class="col">
                <h3>Auto 1</h3>
                <h3><span id="speed0">0</span> km/h</h3>
                <p>Round: <span id="round0">0</span></p>
            </div>
            <!-- Auto 2 -->
            <div class="col">
                <h3>Auto 2</h3>
                <h3><span id="speed1">0</span> km/h</h3>
                <p>Round: <span id="round1">0</span></p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // WebSocket-Verbindung
        const speed0Element = document.getElementById('speed0');
        const speed1Element = document.getElementById('speed1');
        const round0Element = document.getElementById('round0');
        const round1Element = document.getElementById('round1');

        const socket = new WebSocket(
            'ws://' + window.location.host + '/ws/dashboard/'
        );

        // Wenn eine Nachricht kommt, in HTML eintragen
        socket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            speed0Element.textContent = (data.speed0 ? data.speed0 : '0') + " km/h";
            speed1Element.textContent = (data.speed1 ? data.speed1 : '0') + " km/h";
            round0Element.textContent = data.round0 ? data.round0 : '0';
            round1Element.textContent = data.round1 ? data.round1 : '0';
        };

        socket.onopen = function(e) {
            console.log("WebSocket verbunden.");
        };

        socket.onclose = function(e) {
            console.error("WebSocket getrennt.");
        };
    </script>
</body>
</html>